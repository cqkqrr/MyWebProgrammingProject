@model IEnumerable<MyWebProgrammingProject.Models.Appointment>

@{
    ViewData["Title"] = User.IsInRole("Admin") ? "Randevu Yönetimi" : "Programım";
}

<div class="container py-5">

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-5">
        <div class="mb-3 mb-md-0">
            <h1 class="display-5 fw-bold text-white">
                @(User.IsInRole("Admin") ? "RANDEVU" : "BENİM") <span class="text-primary-custom">PROGRAMIM</span>
            </h1>
            <p class="text-muted">
                @(User.IsInRole("Admin") ? "Üyelerin randevu taleplerini buradan yönetebilirsiniz." : "Antrenman takvimin ve yaklaşan derslerin.")
            </p>
        </div>

        <a asp-action="Create" class="btn btn-success btn-lg shadow-lg hover-scale">
            <i class="fas fa-plus-circle me-2"></i> YENİ RANDEVU AL
        </a>
    </div>

    @if (!Model.Any())
    {
        <div class="card bg-dark text-white border-secondary border-dashed text-center p-5">
            <div class="card-body">
                <div class="mb-3">
                    <i class="fas fa-calendar-times fa-4x text-muted opacity-25"></i>
                </div>
                <h3 class="text-white">Henüz Randevu Yok</h3>
                <p class="text-muted mb-4">Kendine bir hedef koy ve ilk antrenmanını planla!</p>
                <a asp-action="Create" class="btn btn-outline-primary">
                    Hemen Başla
                </a>
            </div>
        </div>
    }
    else
    {
        <div class="card bg-dark text-white border-secondary shadow-lg overflow-hidden">
            <div class="table-responsive">
                <table class="table table-dark table-hover mb-0 align-middle">
                    <thead class="bg-secondary text-white">
                        <tr>
                            @if (User.IsInRole("Admin"))
                            {
                                <th class="py-3 ps-4">ÜYE</th>
                            }
                            <th class="py-3 @(User.IsInRole("Admin") ? "" : "ps-4")">EĞİTMEN</th>
                            <th class="py-3">HİZMET</th>
                            <th class="py-3">TARİH & SAAT</th>
                            <th class="py-3 text-center">DURUM</th>
                            <th class="py-3">NOTLAR</th>
                            @if (User.IsInRole("Admin"))
                            {
                                <th class="py-3 text-end pe-4">İŞLEM</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                @if (User.IsInRole("Admin"))
                                {
                                    <td class="ps-4">
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle bg-primary text-white me-2">
                                                @(item.User?.FullName?.Substring(0, 1).ToUpper() ?? "U")
                                            </div>
                                            <div>
                                                <div class="fw-bold">@item.User?.FullName</div>
                                                <div class="small text-muted" style="font-size: 0.8rem;">@item.User?.Email</div>
                                            </div>
                                        </div>
                                    </td>
                                }

                                <td class="@(User.IsInRole("Admin") ? "" : "ps-4")">
                                    <span class="text-warning fw-bold">@item.Trainer?.FullName</span>
                                </td>

                                <td>
                                    <span class="badge bg-secondary border border-secondary">
                                        <i class="fas fa-dumbbell me-1"></i> @item.Service?.Name
                                    </span>
                                </td>

                                <td>
                                    <div class="d-flex flex-column">
                                        <span class="fw-bold text-white">@item.StartTime.ToString("d MMMM yyyy")</span>
                                        <span class="small text-muted">@item.StartTime.ToString("HH:mm") - @item.EndTime.ToString("HH:mm")</span>
                                    </div>
                                </td>

                                <td class="text-center">
                                    @if (item.IsApproved)
                                    {
                                        <span class="badge bg-success bg-opacity-10 text-success px-3 py-2 rounded-pill">
                                            <i class="fas fa-check-circle me-1"></i> ONAYLI
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-warning bg-opacity-10 text-warning px-3 py-2 rounded-pill">
                                            <i class="fas fa-clock me-1"></i> BEKLİYOR
                                        </span>
                                    }
                                </td>

                                <td class="text-muted small">
                                    @(string.IsNullOrWhiteSpace(item.AdminMessage) ? "-" : item.AdminMessage)
                                </td>

                                @if (User.IsInRole("Admin"))
                                {
                                    <td class="text-end pe-4">
                                        @if (!item.IsApproved)
                                        {
                                            <div class="btn-group shadow-sm">
                                                <a asp-action="Approve" asp-route-id="@item.Id" class="btn btn-sm btn-success" title="Onayla">
                                                    <i class="fas fa-check"></i>
                                                </a>
                                                <a asp-action="Reject" asp-route-id="@item.Id" class="btn btn-sm btn-danger" title="Reddet">
                                                    <i class="fas fa-times"></i>
                                                </a>
                                            </div>
                                        }
                                        else
                                        {
                                            <span class="text-muted small"><i class="fas fa-check-double"></i> Tamamlandı</span>
                                        }
                                    </td>
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>

<style>
    /* Özel Stiller */
    .avatar-circle {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.9rem;
    }

    .hover-scale {
        transition: transform 0.2s;
    }

        .hover-scale:hover {
            transform: translateY(-3px);
        }

    .border-dashed {
        border-style: dashed !important;
        border-width: 2px !important;
    }

    /* Tablo Satır Hover Efekti */
    .table-hover tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.05);
    }
</style>